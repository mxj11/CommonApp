一、即时通讯的原理：
第一步，用户A输入自己的用户名和密码登录IM服务器， 服务器通过读取用户数据库来验证用户身份，如果验证通过，登记用户A的IP
地址、IM客户端软件的版本号及使用的TCP/UDP端口号，然后返回用户A登录成功的标志，此时用户A在IM系统中的状态为在线
（Online Presence）。

第二步，根据用户A存储在IM服务器上的好友列表 （Buddy List），服务器将用户A在线的相关信息发送给也同时在线的IM好友的PC
机，这些信息包括在线状态、IP地址、IM客户端使用的TCP端口 （Port）号等，IM好友的客户端收到此信息后将在予以提示。

第三步是IM服务器把用户A存储在服务器上的好友列表及相关信息回送到他的客户端机，这些信息包括也在线状态、IP地址、IM客户
端使用的TCP端口（Port）号等信息，用户A的IM客户端收到后将显示这些好友列表及其在线状态。

二、IM通讯方式
1.在线直接通讯
如果用户A想与他的在线好友用户B聊天，他将直接通过服务器发送过来的用户B的IP地址、TCP端口号等信息，直接向用户B的PC机发
出聊天信息，用户B的IM客户端软件收到后显示在屏幕上，然后用户B再直接回复到用户A的PC机，这样双方的即时文字消息就不再IM
服务器中转，而是直接通过网络进行点对点 的通讯，即对等通讯方式（Peer To Peer）。
2.在线代理通讯
用户A与用户B的点对点通讯由于防火墙、网络速度等原因难以建立或者速度很慢，IM服务器将会主动提供消息中转服务，即用户A和用
户B的即时消息全部先发送到IM服务器，再由服务器转发给对方。
3.离线代理通讯
用户A与用户B由于各种原因不能同时在线的时候，如此时A向B发送消息，IM服务器可以主动寄存A用户的消息，到B用户下一次登陆的
时候，自动将消息转发给B。
4.扩展方式通讯
用户A可以通过IM服务器将信息以扩展的方式传递给B，如短信发送方式发送到B的手机，传真发送方式传递给B的电话机，以email的
方式传递给B的电子邮箱等。

